// components/MarketingPDFDocument.js
import React from 'react';
import { Page, Text, View, Document, StyleSheet, Image, Font } from '@react-pdf/renderer';

// Note: @react-pdf/renderer doesn't support all CSS. It uses a subset via Flexbox.
// We are defining fonts to support bold/italic styles.
Font.register({
    family: 'Roboto',
    fonts: [
        { src: '/fonts/Roboto-Regular.ttf', fontWeight: 400, fontStyle: 'normal' },
        { src: '/fonts/Roboto-Bold.ttf', fontWeight: 700, fontStyle: 'normal' },
        { src: '/fonts/Roboto-Italic.ttf', fontWeight: 400, fontStyle: 'italic' },
        { src: '/fonts/Roboto-BoldItalic.ttf', fontWeight: 700, fontStyle: 'italic' },
    ]
});

const styles = StyleSheet.create({
    page: {
        paddingTop: '15mm',
        paddingBottom: '20mm',
        paddingHorizontal: '15mm',
        fontFamily: 'Roboto',
        fontSize: 10,
        lineHeight: 1.5,
        color: '#333333',
    },
    centerPage: {
        display: 'flex',
        flexDirection: 'column',
        justifyContent: 'center',
        alignItems: 'center',
        height: '100%',
    },
    logo: { width: 180, marginBottom: 15 },
    h1: { fontSize: 28, fontWeight: 700, color: '#1D2951', marginBottom: 15, textAlign: 'center' },
    h2: { fontSize: 18, fontWeight: 700, color: '#1D2951', borderBottom: 2, borderColor: '#4A90E2', paddingBottom: 8, marginBottom: 20, alignSelf: 'flex-start' },
    h3: { fontSize: 12, fontWeight: 700, color: '#1D2951', marginBottom: 5 },
    text: { marginBottom: 10, fontWeight: 400 },
    italic: { fontStyle: 'italic' },
    coverPageText: { fontFamily: 'Roboto', fontSize: 12, marginTop: 80, fontWeight: 400 },
    coverPageName: { fontFamily: 'Roboto', fontWeight: 700, fontSize: 20, color: '#1D2951', marginTop: 5 },
    analysisBox: { marginTop: 15, padding: 15, backgroundColor: '#F8F9FA', border: '1px solid #DEE2E6', borderRadius: 5, marginBottom: 15 },
    chartImage: { width: '90%', marginTop: 10, marginBottom: 15, alignSelf: 'center' },
    footer: { position: 'absolute', bottom: '10mm', left: '15mm', right: '15mm', textAlign: 'center', color: 'grey', fontSize: 8 },
});

const Bullet = ({ children }) => (
    <View style={{ flexDirection: 'row', marginBottom: 5 }}>
        <Text style={{ marginRight: 5 }}>•</Text>
        <Text style={{ flex: 1 }}>{children}</Text>
    </View>
);

// This is your new PDF component
const MarketingPDFDocument = ({ report, logoDataURI, chartImages }) => {
    if (!report) return <Document><Page><Text>Loading...</Text></Page></Document>;

    const { scoredResults, executiveSummary, detailedAnalysis, reportStructureData, executiveSummaryDescriptions } = report;

return (
    <Document>
        {/* --- Cover Page --- */}
        <Page size="A4" style={styles.page}>
            <View style={styles.centerPage}>
                {logoDataURI && <Image style={styles.logo} src={logoDataURI} alt="Logo" />}
                <Text style={styles.h1}>The Marketing Influence Quotient™</Text>
                <Text style={{ color: '#4A90E2', fontSize: 14 }}>Accelerating Success</Text>
                <Text style={styles.coverPageText}>Personalized Report For:</Text>
                <Text style={styles.coverPageName}>{report.userInfo?.name || 'Valued Professional'}</Text>
            </View>
            <Text style={styles.footer} fixed>The Marketing Influence Quotient™ • Accelerating Success • www.leadershipaccel.com</Text>
        </Page>

        {/* --- Static Pages --- */}
        <Page size="A4" style={styles.page}>
            <Text style={styles.h2}>Assessment Details</Text>
            <Text style={styles.h3}>Purpose & Scope</Text>
            <Text style={styles.text}>The Marketing Influence Quotient™ (MIQ) is designed to measure not only what professionals know about marketing but how they think, decide, and influence outcomes in complex business environments...</Text>
            <Text style={styles.h3}>Methodology & Psychometrics</Text>
            <Text style={styles.text}>The Marketing Influence Quotient™ has been developed through a rigorous multi-stage design process that combines marketing expertise, behavioural science, and psychometric best practice...</Text>
            <Text style={styles.footer} fixed>The Marketing Influence Quotient™ • Accelerating Success • www.leadershipaccel.com</Text>
        </Page>
        
        {/* --- Executive Summary Page --- */}
        <Page size="A4" style={styles.page}>
            <Text style={styles.h2}>Executive Summary</Text>
            {Object.entries(executiveSummaryDescriptions).map(([key, value]) => (
                <View key={key} wrap={false} style={{ marginBottom: 15 }}>
                    <Text style={styles.h3}>{value.title}</Text>
                    <Text style={{ ...styles.text, ...styles.italic, fontSize: 9 }}>{value.description}</Text>
                    <Text style={{ ...styles.analysisBox, padding: 10 }}>{executiveSummary[key]}</Text>
                </View>
            ))}
            <Text style={styles.footer} fixed>The Marketing Influence Quotient™ • Accelerating Success • www.leadershipaccel.com</Text>
        </Page>

        {/* --- Key Findings Page --- */}
        <Page size="A4" style={styles.page}>
            <Text style={styles.h2}>Key Findings at a Glance</Text>
            <Text style={{ ...styles.italic, marginBottom: 20 }}>This section provides a visual summary of the participant’s performance, allowing direct comparison against peer groups and industry benchmarks.</Text>
            <Text style={{...styles.h1, fontSize: 20, marginBottom: 10}}>Your Marketing Index: {scoredResults.percentage.toFixed(1)}%</Text>
            {chartImages['keyFindings'] && <Image style={styles.chartImage} src={chartImages['keyFindings']} alt="Key Findings Chart" />}
            <Text style={styles.footer} fixed>The Marketing Influence Quotient™ • Accelerating Success • www.leadershipaccel.com</Text>
        </Page>

        {/* --- Detailed Analysis Pages --- */}
        {Object.keys(reportStructureData).map((key) => {
            const staticData = reportStructureData[key];
            const aiAnalysis = detailedAnalysis[key];
            if (!staticData || !aiAnalysis) return null;
            const isTradeoff = !!staticData.subTopics;

            return (
                <Page key={key} size="A4" style={styles.page} wrap>
                    <Text style={styles.h2}>{staticData.title}</Text>
                    <Text style={{ ...styles.text, ...styles.italic }}>{staticData.mainDescription}</Text>
                    
                    {isTradeoff ? (
                        <>
                            <Text style={styles.h3}>{staticData.subTopicsTitle}</Text>
                            {staticData.subTopics.map((topic, i) => <Bullet key={i}>{topic}</Bullet>)}
                            <Text style={styles.h3}>{staticData.judgedByTitle}</Text>
                            {staticData.judgedByItems.map((item, i) => <Bullet key={i}>{item}</Bullet>)}
                            <Text style={styles.h3}>{staticData.mattersWhyTitle}</Text>
                            <Text style={styles.text}>{staticData.mattersWhyText}</Text>
                        </>
                    ) : (
                        <Text style={styles.text}>{staticData.performanceContext}</Text>
                    )}
                    
                    <View style={styles.analysisBox} wrap={false}>
                        <Text style={{ ...styles.h3, textAlign: 'center' }}>Your Personalized Analysis</Text>
                        {chartImages[key] && <Image style={styles.chartImage} src={chartImages[key]} alt={`Chart for ${staticData.title}`} />}
                        <View>
                            <Text style={styles.h3}>Diagnostic Review</Text>
                            <Text style={styles.text}>{aiAnalysis.diagnosticReview}</Text>
                            <Text style={styles.h3}>Benchmark Comparison</Text>
                            <Text style={styles.text}>{aiAnalysis.benchmarkComparison}</Text>
                            <Text style={styles.h3}>Career Implications</Text>
                            <Text style={styles.text}>{aiAnalysis.careerImplications}</Text>
                        </View>
                    </View>
                    <Text style={styles.footer} fixed>The Marketing Influence Quotient™ • Accelerating Success • www.leadershipaccel.com</Text>
                </Page>
            );
        })}

        {/* --- Final Logo Page --- */}
        <Page size="A4" style={styles.page}>
            <View style={styles.centerPage}>
                {logoDataURI && <Image style={styles.logo} src={logoDataURI} alt="Logo" />}
                <Text style={{ color: '#4A90E2', fontSize: 20 }}>Accelerating Success</Text>
            </View>
            <Text style={styles.footer} fixed>The Marketing Influence Quotient™ • Accelerating Success • www.leadershipaccel.com</Text>
        </Page>
    </Document>
);

};

export default MarketingPDFDocument;